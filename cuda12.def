Bootstrap: docker
From: ubuntu:24.04

%environment
    export CUDA_HOME=/usr/local/cuda
    export PATH=$CUDA_HOME/bin:$PATH
    export LD_LIBRARY_PATH=$CUDA_HOME/lib64:$LD_LIBRARY_PATH

%files

%post
    cd /

    export DEBIAN_FRONTEND=noninteractive

    apt update
    apt install -y build-essential autoconf autotools-dev cmake
    apt install -y wget hwloc flex libfl-dev libreadline-dev zlib1g-dev libgmp-dev libmpfr-dev libmpc-dev libscotch-dev libptscotch-dev libmetis-dev git vim libpmi2-0 libpmi2-0-dev openmpi-bin openmpi-common libopenmpi-dev

    apt update
    apt install -y nvidia-driver-550

    wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2404/x86_64/cuda-ubuntu2404.pin
    mv cuda-ubuntu2404.pin /etc/apt/preferences.d/cuda-repository-pin-600
    wget https://developer.download.nvidia.com/compute/cuda/12.9.0/local_installers/cuda-repo-ubuntu2404-12-9-local_12.9.0-575.51.03-1_amd64.deb
    dpkg -i cuda-repo-ubuntu2404-12-9-local_12.9.0-575.51.03-1_amd64.deb
    cp /var/cuda-repo-ubuntu2404-12-9-local/cuda-*-keyring.gpg /usr/share/keyrings/
    apt-get update
    apt-get -y install cuda-toolkit-12-9
    rm cuda-repo-ubuntu2404-12-9-local_12.9.0-575.51.03-1_amd64.deb

    apt clean
    rm -rf /var/lib/apt/lists/*
